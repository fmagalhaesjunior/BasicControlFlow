trigger:
  branches:
    include:
      - release02

pool:
  vmImage: 'windows-latest'

variables:
  buildConfiguration: 'Release'
  outputDir: '$(Build.ArtifactStagingDirectory)/drop'

steps:

# 1. Checkout do cÃ³digo
- task: Checkout@1
  displayName: 'ðŸ“¥ Checkout do cÃ³digo'

# 2. Setup .NET
- task: UseDotNet@2
  displayName: 'ðŸ§° Instalar SDK .NET'
  inputs:
    packageType: 'sdk'
    version: '9.x'

# 3. Restore
- script: dotnet restore
  displayName: 'ðŸ“¦ Restore dos pacotes'

# 4. Build
- script: dotnet build --no-restore --configuration $(buildConfiguration)
  displayName: 'ðŸ”§ Build da aplicaÃ§Ã£o'

# 5. Testes
- script: dotnet test --no-build --configuration $(buildConfiguration)
  displayName: 'âœ… Executar Testes Automatizados'

# 6. Publish da API para pasta de saÃ­da
- script: dotnet publish src/BasicControlFlow.Web/BasicControlFlow.Web.csproj -c $(buildConfiguration) -o $(outputDir)
  displayName: 'ðŸ“¤ Publicar API para pasta $(outputDir)'

# 7. Salvar artefato (simulaÃ§Ã£o de deploy)
- task: PublishBuildArtifacts@1
  displayName: 'ðŸ“¦ Publicar artefato de build'
  inputs:
    PathtoPublish: '$(outputDir)'
    ArtifactName: 'api-drop'
    publishLocation: 'Container'
